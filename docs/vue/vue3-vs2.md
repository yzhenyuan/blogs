# vue3 å’Œ vue ä¸­çš„å·®å¼‚

åŸºäºå‡½æ•°å¼ç¼–ç¨‹

## ä¸€ã€å…¥å£æ–‡ä»¶

```js
import {createApp} from 'vue'
const app = createApp(App);
app.use();
app.mixins();
app.component();
app.directive();
app.mount("#root");
```

## äºŒã€Fragement template

å¯ä»¥ä½¿ç”¨å¤šä¸ªèŠ‚ç‚¹

```js
<template>
    <div>
        <p>demo1<p>
        <p>demo2<p>
    <div>
</template>
```

```js
<template>
    <p>demo1<p>
    <p>demo2<p>
</template>
```

## ä¸‰ã€style

```scss
// ::v-deep()

<style lang="scss" scoped>
  .openApi-radio{
    margin:10px 0 20px;
    ::v-deep().el-radio-button__inner{
      border: 1px solid rgb(220, 223, 230);
    }
    // /deep/ .el-radio-button__inner{
    //   border: 1px solid rgb(220, 223, 230);
    // }

  }
</style>
```

## å››ã€Suspense

ä¸€å¼€å§‹æ˜¯ react ä¸­ æ‰æœ‰çš„ï¼Œvue2 ä¸­ä¸€èˆ¬ä½¿ç”¨ `v-if`å»æ¨¡æ‹Ÿ

### ğŸ© å¼‚æ­¥ç»„ä»¶ä½œç”¨

- åœ¨é¡µé¢åŠ è½½ä¹‹å‰æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
- æ˜¾ç¤ºå ä½ç¬¦å†…å®¹
- å¤„ç†å»¶è¿ŸåŠ è½½çš„å›¾åƒ

```ts
    <Suspense>
        <template #default>
            <HeaderNav />
        </template>
        <template #fallback> Loading ... </template>
    </Suspense>
    // ç»“åˆdifineSyncComponentsä½¿ç”¨
```

<!-- ## æ‰€æœ‰çš„æ•°æ®éƒ½ä»£ç†åˆ°proxyä¸Š -->

## äº”ã€å¯ä»¥ä½¿ç”¨ jsx + tsx

```ts
import {h} from 'vue'
const React = { createElement: h }
// ä¸ºäº†è®© tsx è½¬æ¢ä¹‹åçš„ä»£ç å¯ä»¥æ­£ç¡®å¼•ç”¨åˆ° vue
```

## å…­ã€ é‡æ„ Virtual DOMï¼Œä¿®æ”¹äº†diffç®—æ³•
1. æ¨¡æ¿ç¼–è¯‘æ—¶çš„ä¼˜ï¼šå°†ä¸€äº›é™æ€èŠ‚ç‚¹ç¼–è¯‘æˆå¸¸é‡
2. slotä¼˜åŒ–ï¼šå°†slotç¼–è¯‘ä¸ºlazyå‡½æ•°ï¼Œå°†slotçš„æ¸²æŸ“çš„å†³å®šæƒäº¤ç»™å­ç»„ä»¶
3. æ¨¡æ¿ä¸­å†…è”äº‹ä»¶çš„æå–å¹¶é‡ç”¨ï¼ˆåŸæœ¬æ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°ç”Ÿæˆå†…è”å‡½æ•°ï¼‰
4. ä»£ç ç»“æ„è°ƒæ•´ï¼šæ›´ä¾¿äºTree shakingï¼ˆå®é™…æƒ…å†µä¸­ï¼Œè™½ç„¶ä¾èµ–äº†æŸä¸ªæ¨¡å—ï¼Œä½†å…¶å®åªä½¿ç”¨å…¶ä¸­çš„æŸäº›åŠŸèƒ½ã€‚é€šè¿‡ tree-shakingï¼Œå°†æ²¡æœ‰ä½¿ç”¨çš„æ¨¡å—æ‘‡æ‰ï¼Œè¿™æ ·æ¥è¾¾åˆ°åˆ é™¤æ— ç”¨ä»£ç çš„ç›®çš„ã€‚ï¼‰ï¼Œä½¿å¾—ä½“ç§¯æ›´å°
5. ä½¿ç”¨Typescriptæ›¿æ¢Flow
6. ä¿®æ”¹äº†diffç®—æ³•ï¼š vue2éœ€è¦diffæ‰€æœ‰çš„è™šæ‹ŸdomèŠ‚ç‚¹ï¼Œè€Œvue3å‚è€ƒäº†SVELTEæ¡†æ¶çš„æ€æƒ³ï¼Œå…ˆåˆ†å±‚æ¬¡-ç„¶åæ‰¾ä¸å˜åŒ–çš„å±‚-é’ˆå¯¹å˜åŒ–çš„å±‚è¿›è¡Œdiffï¼Œæ›´æ–°é€Ÿåº¦ä¸ä¼šå†å—templateå¤§å°çš„å½±å“ï¼Œè€Œæ˜¯ä»…ç”±å¯å˜çš„å†…å®¹å†³å®šã€‚ç»è¿‡å°¤é›¨æºªè‡ªå·±çš„æµ‹è¯•ï¼Œå¤§æ¦‚æœ‰6å€çš„é€Ÿåº¦æå‡ã€‚

## ä¸ƒã€ ä¸ºä»€ä¹ˆè¦é‡å†™ï¼Ÿ
1. åˆ©ç”¨æ–°çš„è¯­è¨€ç‰¹æ€§ proxy æ‹¦æˆªå¯¹è±¡çš„æŸä¸ªæ“ä½œï¼Œä¸ç”¨å»éå†æ•´ä¸ªå¯¹è±¡
   1. ä¸èƒ½è¯†åˆ«å¯¹è±¡çš„æ·±åº¦åµŒå¥—
   2. æ•°ç»„ä¼šå¯¼è‡´å¤šæ¬¡çš„getã€set
2. è§£å†³æ¶æ„è®¾è®¡é—®é¢˜
   1. vue2 ä»£ç è€¦åˆæ€§å¼ºï¼Œæœ‰å¾ˆå¤šä»£ç apiéƒ½åœ¨å®ä¾‹ä¸Šï¼Œä¸èƒ½tree shaking
   2. vue3 æŠŠå„ä¸ªåŠŸèƒ½çš„æ¨¡å—ç‹¬ç«‹å¼€-->æ–¹ä¾¿åˆ†åŒ…--> composition API
   3. vue2 ç¼–è¯‘æ—¶çš„ä¼˜åŒ–ï¼Œé™æ€èŠ‚ç‚¹ï¼Œæ¨¡æ¿ç¼–è¯‘ï¼ˆæ­£åˆ™åŒ¹é…[æœ‰å›æº¯é—®é¢˜]ï¼‰
      1. vue3é™æ€èŠ‚ç‚¹æå‡ä¼˜åŒ–
      2. é™æ€èŠ‚ç‚¹å­—ç¬¦ä¸²åŒ–
      3. åŠ¨æ€ blockTree/åŠ¨æ€æ ‡è®°
      4. ç¼–è¯‘è¿‡ç¨‹ï¼ŒçŠ¶æ€æœºç¼–è¯‘æ¨¡å¼

å¤„ç†æˆå“åº”å¼æ•°æ®
æ¸²æŸ“å’Œæ•°æ®å…³è”èµ·æ¥ï¼ˆæ•°æ®å˜æ›´ï¼‰




## å…«ã€ä¸ºä»€ä¹ˆæ›´å¿«æ›´å°
### 8.1 å…‹æœè™šæ‹Ÿ DOM çš„ç“¶é¢ˆ

#### vue2 ç‹¬ç‰¹çš„æ¸²æŸ“ç­–ç•¥
å®ƒæä¾›äº†ç±»ä¼¼äº HTML çš„æ¨¡æ¿è¯­æ³•ï¼Œä½†æ˜¯å°†æ¨¡æ¿ç¼–è¯‘ä¸ºå¯è¿”å›è™šæ‹Ÿ DOM æ ‘çš„æ¸²æŸ“å‡½æ•°
#### ç‰¹ç‚¹
1. é€šè¿‡é€’å½’éå†ä¸¤ä¸ªè™šæ‹Ÿ DOM æ ‘ï¼Œå¹¶æ¯”è¾ƒæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„æ¯ä¸ªå±æ€§æ¥ç¡®å®šçœŸå® DOM çš„å“ªäº›éƒ¨åˆ†éœ€è¦æ›´æ–°
2. ä½†æ˜¯æ›´æ–°ä»ç„¶æ¶‰åŠè®¸å¤šä¸å¿…è¦çš„ CPU å·¥ä½œã€‚å½“æ‚¨æŸ¥çœ‹çš„æ¨¡æ¿ä¸­å¤§éƒ¨åˆ†æ˜¯é™æ€å†…å®¹å¹¶ä¸”åªæœ‰å°‘é‡åŠ¨æ€ç»‘å®šæ—¶ï¼Œæ•ˆç‡ä½ä¸‹å°¤å…¶æ˜æ˜¾-æ•´ä¸ªè™šæ‹Ÿ DOM æ ‘ä»éœ€è¦é€’å½’éå†ä»¥æ‰¾å‡ºæ›´æ”¹ä¹‹å¤„ã€‚
3. æ¨¡æ¿ç¼–è¯‘æ­¥éª¤ä½¿æˆ‘ä»¬æœ‰æœºä¼š å¯¹æ¨¡æ¿è¿›è¡Œé™æ€åˆ†æ å¹¶æå–æœ‰å…³åŠ¨æ€éƒ¨åˆ†çš„ä¿¡æ¯ï¼Œé€šè¿‡è·³è¿‡é™æ€å­æ ‘åœ¨æŸç§ç¨‹åº¦ä¸Šåšåˆ°äº†è¿™ä¸€ç‚¹
4. Vue 2 é€šè¿‡è·³è¿‡é™æ€å­æ ‘åœ¨æŸç§ç¨‹åº¦ä¸Šåšåˆ°äº†è¿™ä¸€ç‚¹ï¼Œä¸è¿‡ç”±äºç¼–è¯‘å™¨ä½“ç³»ç»“æ„è¿‡äºç®€å•ï¼Œéš¾ä»¥è¿›è¡Œæ›´é«˜çº§çš„ä¼˜åŒ–
5. åœ¨ Vue 3ä¸­ï¼Œä½¿ç”¨é€‚å½“çš„ AST è½¬æ¢ pipeline é‡å†™äº†ç¼–è¯‘å™¨ï¼Œè¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä»¥è½¬æ¢æ’ä»¶çš„å½¢å¼ç¼–å†™ç¼–è¯‘æ—¶çš„ä¼˜åŒ–

### æ¶ˆé™¤ä¸å¿…è¦çš„è™šæ‹ŸDOMæ ‘éå†å’Œå±æ€§æ¯”è¾ƒ
ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶å¿…é¡»åŒæ—¶å·¥ä½œï¼šç¼–è¯‘å™¨åˆ†ææ¨¡æ¿å’Œç”Ÿæˆå¸¦æœ‰ä¼˜åŒ–æç¤ºçš„ä»£ç ï¼ŒåŒæ—¶ï¼Œè¿è¡Œæ—¶æ‹¾å–è¿™äº›æç¤ºï¼Œå¹¶é‡‡å–å°½å¯èƒ½å¿«çš„æ›´æ–°ç­–ç•¥



vue2æµç¨‹
æ¨¡æ¿ template==> æœ¬åœ°ç¼–è¯‘æˆrender() ==> ä¸Šçº¿åˆ°æœåŠ¡ç«¯ ==> æµè§ˆå™¨åŠ è½½ä¸‹æ¥

1. new Vue()å®ä¾‹ï¼Œè¿‡ç¨‹å½“ä¸­ğŸ‘‡
2. Observer æŠŠæ•°æ®å¤„ç†æˆå“åº”å¼æ•°æ®
3. ä¹‹åï¼Œç»‘å®šå¯¹åº”çš„get/set
   1. get æ”¶é›†
   2. set åˆ†å‘
   3. è¿™ä¸ªæ—¶å€™å¹¶æ²¡æœ‰é©¬ä¸Šå»è§¦å‘get/set
4. æµè§ˆå™¨æ‰§è¡Œrenderï¼Œè¿‡ç¨‹å½“ä¸­ğŸ‘‡
   1. åˆ›å»ºVNode 
   2. ä¼šä½¿ç”¨with()ï¼Œä¸Šé¢æœ‰ä¸ªthis æŒ‡å‘ vueå®ä¾‹ï¼Œåœ¨é‡Œé¢ä½¿ç”¨æ•°æ®çš„æ—¶å€™ä¼šè§¦å‘ get 
5. åŒæ—¶ renderçš„æ—¶å€™ï¼Œä¼šå»new watcherï¼ˆä¸€ä¸ªç»„ä»¶å¯¹åº”ä¸€ä¸ªwatcherï¼‰ï¼Œä¸€ä¸ªç»„ä»¶ç¼–è¯‘æˆä¸€ä¸ªrender
   1. åŠ åˆ°dep.targetä¸Šé¢


ä¸»è¦åˆ†ä¸‰æ­¥
1. åˆå§‹åŒ–
   1. æŠŠæ•°æ®å¤„ç†æˆå“åº”å¼æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åŠ ä¸Š setter/getterå‡½æ•°
   2. Depå°±æ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ç±»
   3. æ¯ä¸€ä¸ªdataçš„å±æ€§éƒ½ä¼šæœ‰ä¸€ä¸ªdepå¯¹è±¡
   4. å½“getterè°ƒç”¨çš„æ—¶å€™ï¼Œå»depé‡Œæ³¨å†Œ
   5. setterçš„æ—¶å€™ï¼Œå°±æ˜¯å»é€šçŸ¥æ‰§è¡Œåˆšåˆšæ³¨å†Œçš„å‡½æ•°
2. æŒ‚è½½
   1. ä¼šåˆ›å»ºä¸€ä¸ªWatcherç±»çš„å¯¹è±¡ï¼ŒWatcherå®é™…ä¸Šæ˜¯è¿æ¥Vueç»„ä»¶ä¸Depçš„æ¡¥æ¢
   3. æ¯ä¸€ä¸ªWatcherå¯¹åº”ä¸€ä¸ªç»„ä»¶
3. æ›´æ–°
   1. å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œè°ƒç”¨Depçš„notifyå‡½æ•°
   2. é€šçŸ¥æ‰€æœ‰çš„Watcherè°ƒç”¨updateå‡½æ•°æ›´æ–°